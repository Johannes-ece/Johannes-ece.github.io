{"version":3,"file":"hint.cjs2.js","sources":["../../codemirror-graphql/esm/utils/hintList.js","../../codemirror-graphql/esm/variables/hint.js"],"sourcesContent":["export default function hintList(cursor, token, list) {\n    const hints = filterAndSortList(list, normalizeText(token.string));\n    if (!hints) {\n        return;\n    }\n    const tokenStart = token.type !== null && /\"|\\w/.test(token.string[0])\n        ? token.start\n        : token.end;\n    return {\n        list: hints,\n        from: { line: cursor.line, ch: tokenStart },\n        to: { line: cursor.line, ch: token.end },\n    };\n}\nfunction filterAndSortList(list, text) {\n    if (!text) {\n        return filterNonEmpty(list, entry => !entry.isDeprecated);\n    }\n    const byProximity = list.map(entry => ({\n        proximity: getProximity(normalizeText(entry.text), text),\n        entry,\n    }));\n    const conciseMatches = filterNonEmpty(filterNonEmpty(byProximity, pair => pair.proximity <= 2), pair => !pair.entry.isDeprecated);\n    const sortedMatches = conciseMatches.sort((a, b) => (a.entry.isDeprecated ? 1 : 0) - (b.entry.isDeprecated ? 1 : 0) ||\n        a.proximity - b.proximity ||\n        a.entry.text.length - b.entry.text.length);\n    return sortedMatches.map(pair => pair.entry);\n}\nfunction filterNonEmpty(array, predicate) {\n    const filtered = array.filter(predicate);\n    return filtered.length === 0 ? array : filtered;\n}\nfunction normalizeText(text) {\n    return text.toLowerCase().replaceAll(/\\W/g, '');\n}\nfunction getProximity(suggestion, text) {\n    let proximity = lexicalDistance(text, suggestion);\n    if (suggestion.length > text.length) {\n        proximity -= suggestion.length - text.length - 1;\n        proximity += suggestion.indexOf(text) === 0 ? 0 : 0.5;\n    }\n    return proximity;\n}\nfunction lexicalDistance(a, b) {\n    let i;\n    let j;\n    const d = [];\n    const aLength = a.length;\n    const bLength = b.length;\n    for (i = 0; i <= aLength; i++) {\n        d[i] = [i];\n    }\n    for (j = 1; j <= bLength; j++) {\n        d[0][j] = j;\n    }\n    for (i = 1; i <= aLength; i++) {\n        for (j = 1; j <= bLength; j++) {\n            const cost = a[i - 1] === b[j - 1] ? 0 : 1;\n            d[i][j] = Math.min(d[i - 1][j] + 1, d[i][j - 1] + 1, d[i - 1][j - 1] + cost);\n            if (i > 1 && j > 1 && a[i - 1] === b[j - 2] && a[i - 2] === b[j - 1]) {\n                d[i][j] = Math.min(d[i][j], d[i - 2][j - 2] + cost);\n            }\n        }\n    }\n    return d[aLength][bLength];\n}\n//# sourceMappingURL=hintList.js.map","import CodeMirror from 'codemirror';\nimport { getNullableType, getNamedType, GraphQLEnumType, GraphQLInputObjectType, GraphQLList, GraphQLBoolean, } from 'graphql';\nimport forEachState from '../utils/forEachState';\nimport hintList from '../utils/hintList';\nCodeMirror.registerHelper('hint', 'graphql-variables', (editor, options) => {\n    const cur = editor.getCursor();\n    const token = editor.getTokenAt(cur);\n    const results = getVariablesHint(cur, token, options);\n    if ((results === null || results === void 0 ? void 0 : results.list) && results.list.length > 0) {\n        results.from = CodeMirror.Pos(results.from.line, results.from.ch);\n        results.to = CodeMirror.Pos(results.to.line, results.to.ch);\n        CodeMirror.signal(editor, 'hasCompletion', editor, results, token);\n    }\n    return results;\n});\nfunction getVariablesHint(cur, token, options) {\n    const state = token.state.kind === 'Invalid' ? token.state.prevState : token.state;\n    const { kind, step } = state;\n    if (kind === 'Document' && step === 0) {\n        return hintList(cur, token, [{ text: '{' }]);\n    }\n    const { variableToType } = options;\n    if (!variableToType) {\n        return;\n    }\n    const typeInfo = getTypeInfo(variableToType, token.state);\n    if (kind === 'Document' || (kind === 'Variable' && step === 0)) {\n        const variableNames = Object.keys(variableToType);\n        return hintList(cur, token, variableNames.map(name => ({\n            text: `\"${name}\": `,\n            type: variableToType[name],\n        })));\n    }\n    if ((kind === 'ObjectValue' || (kind === 'ObjectField' && step === 0)) &&\n        typeInfo.fields) {\n        const inputFields = Object.keys(typeInfo.fields).map(fieldName => typeInfo.fields[fieldName]);\n        return hintList(cur, token, inputFields.map(field => ({\n            text: `\"${field.name}\": `,\n            type: field.type,\n            description: field.description,\n        })));\n    }\n    if (kind === 'StringValue' ||\n        kind === 'NumberValue' ||\n        kind === 'BooleanValue' ||\n        kind === 'NullValue' ||\n        (kind === 'ListValue' && step === 1) ||\n        (kind === 'ObjectField' && step === 2) ||\n        (kind === 'Variable' && step === 2)) {\n        const namedInputType = typeInfo.type\n            ? getNamedType(typeInfo.type)\n            : undefined;\n        if (namedInputType instanceof GraphQLInputObjectType) {\n            return hintList(cur, token, [{ text: '{' }]);\n        }\n        if (namedInputType instanceof GraphQLEnumType) {\n            const values = namedInputType.getValues();\n            return hintList(cur, token, values.map(value => ({\n                text: `\"${value.name}\"`,\n                type: namedInputType,\n                description: value.description,\n            })));\n        }\n        if (namedInputType === GraphQLBoolean) {\n            return hintList(cur, token, [\n                { text: 'true', type: GraphQLBoolean, description: 'Not false.' },\n                { text: 'false', type: GraphQLBoolean, description: 'Not true.' },\n            ]);\n        }\n    }\n}\nfunction getTypeInfo(variableToType, tokenState) {\n    const info = {\n        type: null,\n        fields: null,\n    };\n    forEachState(tokenState, state => {\n        switch (state.kind) {\n            case 'Variable': {\n                info.type = variableToType[state.name];\n                break;\n            }\n            case 'ListValue': {\n                const nullableType = info.type ? getNullableType(info.type) : undefined;\n                info.type =\n                    nullableType instanceof GraphQLList ? nullableType.ofType : null;\n                break;\n            }\n            case 'ObjectValue': {\n                const objectType = info.type ? getNamedType(info.type) : undefined;\n                info.fields =\n                    objectType instanceof GraphQLInputObjectType\n                        ? objectType.getFields()\n                        : null;\n                break;\n            }\n            case 'ObjectField': {\n                const objectField = state.name && info.fields ? info.fields[state.name] : null;\n                info.type = objectField === null || objectField === void 0 ? void 0 : objectField.type;\n                break;\n            }\n        }\n    });\n    return info;\n}\n//# sourceMappingURL=hint.js.map"],"names":["CodeMirror","getNamedType","GraphQLInputObjectType","GraphQLEnumType","GraphQLBoolean","forEachState","getNullableType","GraphQLList"],"mappings":"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"}