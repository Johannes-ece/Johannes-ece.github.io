{"version":3,"file":"info-addon.cjs.js","sources":["../../codemirror-graphql/esm/utils/info-addon.js"],"sourcesContent":["import CodeMirror from 'codemirror';\nCodeMirror.defineOption('info', false, (cm, options, old) => {\n    if (old && old !== CodeMirror.Init) {\n        const oldOnMouseOver = cm.state.info.onMouseOver;\n        CodeMirror.off(cm.getWrapperElement(), 'mouseover', oldOnMouseOver);\n        clearTimeout(cm.state.info.hoverTimeout);\n        delete cm.state.info;\n    }\n    if (options) {\n        const state = (cm.state.info = createState(options));\n        state.onMouseOver = onMouseOver.bind(null, cm);\n        CodeMirror.on(cm.getWrapperElement(), 'mouseover', state.onMouseOver);\n    }\n});\nfunction createState(options) {\n    return {\n        options: options instanceof Function\n            ? { render: options }\n            : options === true\n                ? {}\n                : options,\n    };\n}\nfunction getHoverTime(cm) {\n    const { options } = cm.state.info;\n    return (options === null || options === void 0 ? void 0 : options.hoverTime) || 500;\n}\nfunction onMouseOver(cm, e) {\n    const state = cm.state.info;\n    const target = e.target || e.srcElement;\n    if (!(target instanceof HTMLElement)) {\n        return;\n    }\n    if (target.nodeName !== 'SPAN' || state.hoverTimeout !== undefined) {\n        return;\n    }\n    const box = target.getBoundingClientRect();\n    const onMouseMove = function () {\n        clearTimeout(state.hoverTimeout);\n        state.hoverTimeout = setTimeout(onHover, hoverTime);\n    };\n    const onMouseOut = function () {\n        CodeMirror.off(document, 'mousemove', onMouseMove);\n        CodeMirror.off(cm.getWrapperElement(), 'mouseout', onMouseOut);\n        clearTimeout(state.hoverTimeout);\n        state.hoverTimeout = undefined;\n    };\n    const onHover = function () {\n        CodeMirror.off(document, 'mousemove', onMouseMove);\n        CodeMirror.off(cm.getWrapperElement(), 'mouseout', onMouseOut);\n        state.hoverTimeout = undefined;\n        onMouseHover(cm, box);\n    };\n    const hoverTime = getHoverTime(cm);\n    state.hoverTimeout = setTimeout(onHover, hoverTime);\n    CodeMirror.on(document, 'mousemove', onMouseMove);\n    CodeMirror.on(cm.getWrapperElement(), 'mouseout', onMouseOut);\n}\nfunction onMouseHover(cm, box) {\n    const pos = cm.coordsChar({\n        left: (box.left + box.right) / 2,\n        top: (box.top + box.bottom) / 2,\n    });\n    const state = cm.state.info;\n    const { options } = state;\n    const render = options.render || cm.getHelper(pos, 'info');\n    if (render) {\n        const token = cm.getTokenAt(pos, true);\n        if (token) {\n            const info = render(token, options, cm, pos);\n            if (info) {\n                showPopup(cm, box, info);\n            }\n        }\n    }\n}\nfunction showPopup(cm, box, info) {\n    const popup = document.createElement('div');\n    popup.className = 'CodeMirror-info';\n    popup.appendChild(info);\n    document.body.appendChild(popup);\n    const popupBox = popup.getBoundingClientRect();\n    const popupStyle = window.getComputedStyle(popup);\n    const popupWidth = popupBox.right -\n        popupBox.left +\n        parseFloat(popupStyle.marginLeft) +\n        parseFloat(popupStyle.marginRight);\n    const popupHeight = popupBox.bottom -\n        popupBox.top +\n        parseFloat(popupStyle.marginTop) +\n        parseFloat(popupStyle.marginBottom);\n    let topPos = box.bottom;\n    if (popupHeight > window.innerHeight - box.bottom - 15 &&\n        box.top > window.innerHeight - box.bottom) {\n        topPos = box.top - popupHeight;\n    }\n    if (topPos < 0) {\n        topPos = box.bottom;\n    }\n    let leftPos = Math.max(0, window.innerWidth - popupWidth - 15);\n    if (leftPos > box.left) {\n        leftPos = box.left;\n    }\n    popup.style.opacity = '1';\n    popup.style.top = topPos + 'px';\n    popup.style.left = leftPos + 'px';\n    let popupTimeout;\n    const onMouseOverPopup = function () {\n        clearTimeout(popupTimeout);\n    };\n    const onMouseOut = function () {\n        clearTimeout(popupTimeout);\n        popupTimeout = setTimeout(hidePopup, 200);\n    };\n    const hidePopup = function () {\n        CodeMirror.off(popup, 'mouseover', onMouseOverPopup);\n        CodeMirror.off(popup, 'mouseout', onMouseOut);\n        CodeMirror.off(cm.getWrapperElement(), 'mouseout', onMouseOut);\n        if (popup.style.opacity) {\n            popup.style.opacity = '0';\n            setTimeout(() => {\n                if (popup.parentNode) {\n                    popup.parentNode.removeChild(popup);\n                }\n            }, 600);\n        }\n        else if (popup.parentNode) {\n            popup.parentNode.removeChild(popup);\n        }\n    };\n    CodeMirror.on(popup, 'mouseover', onMouseOverPopup);\n    CodeMirror.on(popup, 'mouseout', onMouseOut);\n    CodeMirror.on(cm.getWrapperElement(), 'mouseout', onMouseOut);\n}\n//# sourceMappingURL=info-addon.js.map"],"names":["CodeMirror"],"mappings":"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"}